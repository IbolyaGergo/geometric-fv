% File: tikz-shapes.tex
% Style
\tikzset{
    % Style for the cell averages u_i
    old values/.style={
        fill=gray,        % Fill color
        fill opacity=0.3,  % Only make the fill transparent, not the border
        draw=black
    },
    % Style for the flux
    flux area/.style={
        color=red,
        opacity=.2
    },
    flux text/.style={
        red,
        align=center,
        fill=white,
        inner sep=1pt,
        opacity=0.9,
        text opacity=1
    },
    explanation godunov/.style={
        below right,
        text width=5cm,
        align=justify,
        font=\small
    },
    avg dot/.style={
        fill=black,
        draw=white,
        thick
    },
    avg text/.style={
        fill=white,       % <--- Clears the area behind text
        inner sep=1pt,    % <--- Tightens the white box
        fill opacity=0.8, % <--- Optional: soft mask
        text opacity=1   % <--- Keep text 100% black
    },
    slope text/.style={
        fill=white,       % <--- Clears the area behind text
        inner sep=1pt,    % <--- Tightens the white box
        fill opacity=0.8, % <--- Optional: soft mask
        text opacity=1,   % <--- Keep text 100% black
        pos=.2,
        sloped,
        above,
        yshift=1pt
    }
}
% Define a command to set up the grid and variables
\newcommand{\DrawFVGrid}{%
    % --- CONFIGURATION ---
    % We use \def so these variables are accessible after this command runs
    \def\dx{1.5}%
    %
    % --- DRAW AXIS ---
    \draw[->] (-1.5*\dx,0) -- (2.5*\dx,0) node[right] {$x$};%
    %
    % --- DRAW TICKS ---
    \foreach \pos/\label in {
        -\dx / x_{i-3/2},
         0   / x_{i-1/2},
         \dx / x_{i+1/2},
         2*\dx / x_{i+3/2}
    } {%
        \draw (\pos, .1) -- (\pos, -.1) node[below] {$\label$};%
    }%
}

\newcommand{\SetupAvgs}{%
    \DrawFVGrid

    \def\dt{.4*\dx}%

    % Heights of the bars
    \def\hL{.4*\dx}  % Left cell (i-1)
    \def\hM{1.1*\dx}  % Middle cell (i)
    \def\hR{1.5*\dx}  % Right cell (i+1)

    % 2. Calculate New Heights (Using PGF Math, not Text replacement)
    % We group variables in (...) to ensure safety against text expansion order
    \pgfmathsetmacro{\hLn}{0.8 * \hL}
    \pgfmathsetmacro{\hMn}{(\dt * \hL) + (\hM - \dt * \hM)}
    \pgfmathsetmacro{\hRn}{(\dt * \hM) + (\hR - \dt * \hR)}

    % Coordinates
    \coordinate (cL) at (-\dx+.5*\dx,\hL);
    \coordinate (cM) at (.5*\dx,\hM);
    \coordinate (cR) at (\dx+.5*\dx,\hR);

    \def\dotSize{1.5pt}
}

\newcommand{\SetupLinear}{%
    \SetupAvgs

    % Slopes
    \pgfmathsetmacro{\sL}{(\hM - \hL)/\dx}
    \pgfmathsetmacro{\sM}{(\hR - \hM)/\dx}
    \pgfmathsetmacro{\sR}{.5*(\hR - \hM)/\dx}

    % Edge values
    \pgfmathsetmacro{\edgeLL}{\hL - .5*\sL*\dx}
    \pgfmathsetmacro{\edgeLR}{\hL + .5*\sL*\dx}
    \pgfmathsetmacro{\edgeML}{\hM - .5*\sM*\dx}
    \pgfmathsetmacro{\edgeMR}{\hM + .5*\sM*\dx}
    \pgfmathsetmacro{\edgeRL}{\hR - .5*\sR*\dx}
    \pgfmathsetmacro{\edgeRR}{\hR + .5*\sR*\dx}
}
