\documentclass[tikz,border=2pt]{standalone}

% Needed for standalone compilation of fig/*.tex
\IfFileExists{../preamble.tex}
{\input{../preamble.tex}}% If compiling *.tex directly
{\input{preamble.tex}}% If compiling main.tex

\IfFileExists{tikz_shapes.tex}
{\input{tikz_shapes.tex}}
{\input{fig/tikz_shapes.tex}}

\pagestyle{empty}

\begin{document}%
\begin{tikzpicture}[x=2cm,y=2cm]
    \SetupLinear

    \foreach \pos \avg \s \idx in {
        -\dx / \hL / \sL / {i-1},
        0    / \hM / \sM / {i},  
        \dx  / \hR / \sR / {i+1} 
    } {
        \pgfmathsetmacro{\edgeR}{\avg + .5*\s*\dx}
        \pgfmathsetmacro{\edgeL}{\avg - .5*\s*\dx}

        \fill[old values]
            (\pos, 0) --
            (\pos+\dx, 0) --
            (\pos+\dx, \edgeR) --
            (\pos, \edgeL) -- cycle;

        \draw (\pos,\edgeL) -- (\pos+\dx,\edgeR);

        \filldraw[fill=black, draw=white, thick] (\pos + 0.5*\dx, \avg) circle (\dotSize);

        \node at (\pos+0.5*\dx, \avg + 0.2) {$u_\idx^n$};
    }

\end{tikzpicture}
\end{document}
